buildscript {
    repositories {
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }
    dependencies {
        classpath 'com.github.jengelman.gradle.plugins:shadow:2.0.1'
    }
}

subprojects{ subproject->
    apply plugin:'groovy'
    apply plugin:'application'
    apply plugin:'com.github.johnrengelman.shadow'
    
    repositories {
        mavenLocal()
        jcenter()
        mavenCentral()
    }
    
    sourceSets{
        main{
            groovy{
                srcDirs=['src']
            }
            resources{
                srcDirs=['cfg']
            }
        }
        test{
            groovy{
                srcDirs=['test']
            }
            /*resources{
                srcDirs=['test/res']
            }*/
        }
    }
    
    mainClassName=subproject.name
    
    dependencies{
        compile 'org.codehaus.groovy:groovy-all:+'
        
        compile 'io.netty:netty-all:4.1.12.Final'
        
        //日志
        compile 'org.apache.logging.log4j:log4j-api:+'
        compile 'org.apache.logging.log4j:log4j-core:+'
        compile 'com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:+'
        compile 'com.fasterxml.jackson.core:jackson-databind:+'
    
    
        if(subproject.name!='Core'){
            compile project(':Core')
            if(subproject.name!='StorageNode'){
                compile project(':StorageNode')
            }
        }
        
    
        testCompile 'org.spockframework:spock-core:+'
    }
    
    compileGroovy{
        options.encoding='UTF-8'
    }
    
    shadowJar{
        doLast{
            copy{
                from 'build/libs/作业2-all.jar'
                into projectDir
                rename({'homework2.jar'})
            }
        }
    }
    
    System.setProperty('file.encoding', 'UTF-8')
}

wrapper{
    gradleVersion = '4.0'
}